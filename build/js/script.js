function carregarPagina(){if(indice<quantidadeItens&&window.scrollY>=screen){screen*=2;var e=indice+4;for(indice;indice<e;indice++){if(!(indice<quantidadeItens)){this.removeEventListener("scroll",carregarPagina);break}montarCatalogo(produtos,indice)}}}function montarCatalogo(e,a){var n=document.createElement("div");n.dataset.promo=e.products[a].on_sale;var r=filtroPromo&&"false"==n.dataset.promo;n.className="item-container",r&&(n.className+=" is-removed");var o=document.createElement("img");o.setAttribute("src",e.products[a].image),o.setAttribute("alt","Imagem de "+e.products[a].name),o.setAttribute("ondragstart","arrastarAoCarrinho(event);"),o.setAttribute("ondragend","pararArrastar();"),o.setAttribute("draggable","true"),o.setAttribute("name",e.products[a].name),o.dataset.indice=a,o.title=e.products[a].name,o.className="item";var i=document.createElement("span");i.textContent=e.products[a].name,i.className="titulo-produto";var d=document.createElement("div");d.className="precos";var s=document.createElement("span");s.textContent=e.products[a].regular_price;var c=e.products[a].discount_percentage;if(d.appendChild(s),""!=c){s.className="valor-promo";var l=document.createElement("span");l.textContent=e.products[a].actual_price,l.className="valor-atual",l.setAttribute("data-parcela",e.products[a].installments);var m=document.createElement("span");m.textContent=c,m.className="desconto",d.appendChild(l),d.appendChild(m)}else s.className="valor-atual",s.setAttribute("data-parcela",e.products[a].installments);var u=document.createElement("div");u.className="sizes";var p=document.createElement("ul"),h=document.createElement("div");h.id="transacao";var C=document.createElement("button");C.textContent="Adicionar ao carrinho",C.setAttribute("onclick","adicionarAoCarrinho(this);"),C.dataset.indice=a;var g=document.createElement("button");g.textContent="Comprar",h.appendChild(C),h.appendChild(g),n.appendChild(o),n.appendChild(i),n.appendChild(d);for(t in e.products[a].sizes){var v=document.createElement("li");v.textContent=e.products[a].sizes[t].size,0==e.products[a].sizes[t].available&&(v.className="nDisponivel"),p.appendChild(v)}n.appendChild(u),n.appendChild(h),u.appendChild(p),document.getElementById("catalogo").appendChild(n)}function filtrarPorPromocao(e){filtroPromo=e.checked;for(var t=document.getElementsByClassName("item-container"),a=0;a<t.length;a++)filtroPromo&&null!=t[a].dataset.promo&&"false"==t[a].dataset.promo?alternarClasse(t[a],"is-removed",!0):alternarClasse(t[a],"is-removed",!1)}function arrastarAoCarrinho(e){e.dataTransfer.setData("indice",e.target.dataset.indice),alternarClasse(document.getElementById("lista-carrinho"),"is-hidden",!1),carrinhoShow=!0}function pararArrastar(){alternarClasse(document.getElementById("lista-carrinho"),"is-hidden",!0),carrinhoShow=!1,document.getElementById("carrinho").getElementsByTagName("button")[0].innerHTML="Acessar carrinho"}function adicionarAoCarrinho(e){adicionar(produtos.products[e.dataset.indice]),alternarClasse(document.getElementById("lista-carrinho"),"is-hidden",!1),setTimeout(function(){alternarClasse(document.getElementById("lista-carrinho"),"is-hidden",!0)},5e3),document.getElementById("carrinho").getElementsByTagName("button")[0].innerHTML="Acessar carrinho",carrinhoShow=!1}function dropItem(e){e.preventDefault(),adicionar(produtos.products[parseInt(e.dataTransfer.getData("indice"))])}function removerItem(e){var t=e.dataset.item,a=contemItemNoCarrinho(t,itensCarrinho);if(itensCarrinho[a].quantidade--,t=itensCarrinho[a],t.quantidade>0)document.getElementById(t.name).childNodes[0].textContent=t.quantidade+" "+t.name+"......."+t.actual_price;else{var n=document.getElementById(t.name);n.parentNode.removeChild(n),itensCarrinho[a]=null,itensCarrinho.sort(),itensCarrinho.pop()}atualizarValor(itensCarrinho)}function adicionar(e){var t=contemItemNoCarrinho(e.name,itensCarrinho);if(-1==t){e.quantidade=0;var a=document.createElement("li");a.id=e.name,a.dataset.src=e.image,a.addEventListener("mouseover",function(){var e=document.getElementById("imagemCarrinho");e.src=this.dataset.src,e.title=this.id,e.setAttribute("alt","Imagem miniatura mostrada no carrinho do "+a.id),alternarClasse(document.getElementById("imagemCarrinho"),"is-hidden",!1)});var n=document.createElement("button");n.dataset.item=a.id,n.textContent="Remove",n.className="btn-remove",n.setAttribute("onclick","removerItem(this);"),a.appendChild(document.createTextNode("")),a.appendChild(n),document.getElementById("item-carrinho").appendChild(a),itensCarrinho.push(e),e.quantidade++}else e=itensCarrinho[t],e.quantidade++,itensCarrinho[t]=e;console.log(e.quantidade);document.createTextNode(e.quantidade+" "+e.name+"......."+e.actual_price);document.getElementById(e.name).childNodes[0].textContent=e.quantidade+" "+e.name+"......."+e.actual_price,atualizarValor(itensCarrinho)}function contemItemNoCarrinho(e,t){for(indice in t)if(t[indice].name==e)return indice;return-1}function atualizarValor(e){total=0;for(item in e)console.log(e[item]),total+=parseFloat(e[item].actual_price.replace("R$ ","").replace(",","."))*e[item].quantidade;document.getElementById("valorTotal").innerHTML=parseFloat(total).toFixed(2).replace(".",",")}function hoverContainer(e){e.preventDefault()}function alternarClasse(e,t,a){a?e.className+=" "+t:e.className=e.className.replace(t,"")}function acessarCarrinho(){alternarClasse(document.getElementById("lista-carrinho"),"is-hidden",carrinhoShow),carrinhoShow=!carrinhoShow,document.getElementById("carrinho").getElementsByTagName("button")[0].innerHTML=carrinhoShow?"Esconder carrinho":"Acessar carrinho"}var produtos=null,quantidadeItens=0,indice=0,screen=30,itensCarrinho=[],total=0,carrinhoShow=!1,filtroPromo=!1;window.onload=function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status)for(produtos=JSON.parse(e.response),quantidadeItens=produtos.products.length,indice;indice<4;indice++)montarCatalogo(produtos,indice);if(4==e.readyState&&200!=e.status){var t=document.createElement("span");t.style.color="#ccc",t.style.fontSize="2em",t.style.fontFamily="Gotham",t.style.display="block",t.textContent="Nenhum produto encontrado",document.getElementById("catalogo").appendChild(t),document.getElementsByTagName("footer")[0].style.bottom="0"}},e.open("GET","service/products.json"),e.send()},document.addEventListener?document.addEventListener("scroll",carregarPagina):document.attachEvent("scroll",function(e){console.log(e),carregarPagina()});